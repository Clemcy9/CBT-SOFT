{% extends 'base.html' %}
{% block content %}
{% if user.is_student %}
<div class="container" style="width: 100vw; display: flex; justify-content: center;">
    
    <div class="parent">
        <h1>
            Student Dashboard
        </h1>
        <h2>
            {% for message in messages %}
                {{message}}
            {% endfor %}
        </h2>
        <table style="width: 100%;">
            <tr>
                <thead>Available Exams</thead>
            </tr>
            <tr>
                <th>Exams Title</th>
                <th>Subject(course)</th>
                <th>Class(level)</th>
                <th>Duration (min)</th>

            </tr>
            {% for quiz in contents %}
                <!-- show only active quiz -->
                {% if quiz.is_available %}
                    <tr>
                        <td><a href="{% url 'cbt_app:take_quiz' quiz.id %}">{{quiz}}</a></td>
                        <td>{{quiz.course}}</td>
                        <td>{{quiz.level}}</td>
                        <td>{{quiz.duration}}</td>
                    </tr>
                {% endif %}
            
            {% endfor %}
        </table>
    </div>
</div>
{% else %}
<div class="container" style="width: 100vw; display: flex; justify-content: center;">
    <div class="parent">
        <h1>
            Examiner Dashboard
        </h1>
        <h2>
            {% for message in messages %}
                {{message}}
            {% endfor %}
        </h2>
        <form action="" method="post">
            {% csrf_token %}
            <table style="width: 100%;">
                <tr>
                    <thead>Prepared Exams</thead>
                </tr>
                <tr>
                    <th>Quiz Title</th>
                    <th>Subject(course)</th>
                    <th>Class</th>
                    <th>Created on</th>
                    <th>Is active</th>
                    <!-- <th>Results</th> -->
    
                </tr>
                {% for x in contents %}
                <tr>
                    
                    <td><a href="{% url 'cbt_app:result_list' x.id %}">{{x}}</a></td>
                    <td>{{x.course}}</td>
                    <td>{{x.level}}</td>
                    <td>{{x.start_time}}</td>
                    <!-- <td>{{x.is_available}}</td> -->
                    <td>
                        <select name="is_active" id="{{x.id}}" onchange="updateDb(this.id,this.value)">
                            {% if x.is_available %}
                                <option value="True" selected>True</option>
                                <option value="False">False</option>
                            {% else %}
                                <option value="True" >True</option>
                                <option value="False" selected>False</option>
                            {% endif %}
                        </select>
                    </td>
                    <!-- <td>{{y}}</td> -->
                </tr>
                {% endfor %}
            </table>
        </form>
        
        <h3>
            Create new quiz
        </h3>
        <ul>
            <li><a href="">Random Questions in Course</a> </li>
            <li><a href="{% url 'create_quiz:by_topic' %}">Particular topic in Course</a></li>
            <li><a href="{% url 'file_processing:question_upload' %}">Upload new Question from excel file</a></li>
        </ul>
    </div>
    <script>
        
// fetch post and get request
    async function makeRequest(url, method, data){
        let headers ={
            'X-Requested-With':'XMLHttpRequest',
            'Content-Type':'application/text'
        }

        if(method == 'post'){
            const csrf = document.querySelector('[name = csrfmiddlewaretoken]').value
            headers['X-CSRFToken'] = csrf
        }

        let response = await fetch(url,{
            method:method,
            headers:headers,
            body:JSON.stringify(data)
        })

        return await response.status
    } 

    function updateDb(x,y){
            makeRequest(
                "{% url 'cbt_app:api_edit_quiz' %}",
                'post',
                {
                    'quiz_id':x, 
                    'is_active':y 
                }
            )
            // alert(['making request data =',x,y])
        }
    </script>
</div>
{% endif %}

{% endblock %}
